<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/alexeyten/qr-image"

    >qr-image (v3.2.0)</a>
</h1>
<h4>QR Code generator (png, svg, pdf, eps)</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.qr-image">module qr-image</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.image">
            function <span class="apidocSignatureSpan">qr-image.</span>image
            <span class="apidocSignatureSpan">(text, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.imageSync">
            function <span class="apidocSignatureSpan">qr-image.</span>imageSync
            <span class="apidocSignatureSpan">(text, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix">
            function <span class="apidocSignatureSpan">qr-image.</span>matrix
            <span class="apidocSignatureSpan">(text, ec_level, parse_url)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.svgObject">
            function <span class="apidocSignatureSpan">qr-image.</span>svgObject
            <span class="apidocSignatureSpan">(text, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">qr-image.</span>png</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">qr-image.</span>qr_base</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">qr-image.</span>vector</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.qr-image.matrix">module qr-image.matrix</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.calculatePenalty">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>calculatePenalty
            <span class="apidocSignatureSpan">(matrix)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.fillAlignAndTiming">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillAlignAndTiming
            <span class="apidocSignatureSpan">(matrix)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.fillData">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillData
            <span class="apidocSignatureSpan">(matrix, data, mask)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.fillFinders">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillFinders
            <span class="apidocSignatureSpan">(matrix)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.fillReserved">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillReserved
            <span class="apidocSignatureSpan">(matrix, ec_level, mask)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.fillStub">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillStub
            <span class="apidocSignatureSpan">(matrix)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.getMatrix">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>getMatrix
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.matrix.init">
            function <span class="apidocSignatureSpan">qr-image.matrix.</span>init
            <span class="apidocSignatureSpan">(version)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.qr-image.png">module qr-image.png</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.png.png">
            function <span class="apidocSignatureSpan">qr-image.</span>png
            <span class="apidocSignatureSpan">(bitmap, stream)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.png.bitmap">
            function <span class="apidocSignatureSpan">qr-image.png.</span>bitmap
            <span class="apidocSignatureSpan">(matrix, size, margin)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.qr-image.qr_base">module qr-image.qr_base</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.qr_base.QR">
            function <span class="apidocSignatureSpan">qr-image.qr_base.</span>QR
            <span class="apidocSignatureSpan">(text, ec_level, parse_url)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.qr_base.fillTemplate">
            function <span class="apidocSignatureSpan">qr-image.qr_base.</span>fillTemplate
            <span class="apidocSignatureSpan">(message, template)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.qr_base.getTemplate">
            function <span class="apidocSignatureSpan">qr-image.qr_base.</span>getTemplate
            <span class="apidocSignatureSpan">(message, ec_level)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.qr-image.vector">module qr-image.vector</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.vector.eps">
            function <span class="apidocSignatureSpan">qr-image.vector.</span>eps
            <span class="apidocSignatureSpan">(matrix, stream, margin)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.vector.pdf">
            function <span class="apidocSignatureSpan">qr-image.vector.</span>pdf
            <span class="apidocSignatureSpan">(matrix, stream, margin)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.vector.svg">
            function <span class="apidocSignatureSpan">qr-image.vector.</span>svg
            <span class="apidocSignatureSpan">(matrix, stream, margin, size)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.qr-image.vector.svg_object">
            function <span class="apidocSignatureSpan">qr-image.vector.</span>svg_object
            <span class="apidocSignatureSpan">(matrix, margin)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.qr-image" id="apidoc.module.qr-image">module qr-image</a></h1>


    <h2>
        <a href="#apidoc.element.qr-image.image" id="apidoc.element.qr-image.image">
        function <span class="apidocSignatureSpan">qr-image.</span>image
        <span class="apidocSignatureSpan">(text, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function qr_image(text, options) {
    options = get_options(options);

    var matrix = QR(text, options.ec_level, options.parse_url);
    var stream = new Readable();
    stream._read = fn_noop;

    switch (options.type) {
    case &#x27;svg&#x27;:
    case &#x27;pdf&#x27;:
    case &#x27;eps&#x27;:
        process.nextTick(function() {
            vector[options.type](matrix, stream, options.margin, options.size);
        });
        break;
    case &#x27;svgpath&#x27;:
        // deprecated, use svg_object method
        process.nextTick(function() {
            var obj = vector.svg_object(matrix, options.margin, options.size);
            stream.push(obj.path);
            stream.push(null);
        });
        break;
    case &#x27;png&#x27;:
    default:
        process.nextTick(function() {
            var bitmap = png.bitmap(matrix, options.size, options.margin);
            if (options.customize) {
                options.customize(bitmap);
            }
            png.png(bitmap, stream);
        });
    }

    return stream;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Usage
-----

Example:
```javascript
var qr = require(&#x27;qr-image&#x27;);

var qr_svg = qr.<span class="apidocCodeKeywordSpan">image</span>(&#x27;I love QR!&#x27;, { type: &#x27;svg&#x27; });
qr_svg.pipe(require(&#x27;fs&#x27;).createWriteStream(&#x27;i_love_qr.svg&#x27;));

var svg_string = qr.imageSync(&#x27;I love QR!&#x27;, { type: &#x27;svg&#x27; });
```

[More examples](./examples)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.imageSync" id="apidoc.element.qr-image.imageSync">
        function <span class="apidocSignatureSpan">qr-image.</span>imageSync
        <span class="apidocSignatureSpan">(text, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function qr_image_sync(text, options) {
    options = get_options(options);

    var matrix = QR(text, options.ec_level, options.parse_url);
    var stream = [];
    var result;

    switch (options.type) {
    case &#x27;svg&#x27;:
    case &#x27;pdf&#x27;:
    case &#x27;eps&#x27;:
        vector[options.type](matrix, stream, options.margin, options.size);
        result = stream.filter(Boolean).join(&#x27;&#x27;);
        break;
    case &#x27;png&#x27;:
    default:
        var bitmap = png.bitmap(matrix, options.size, options.margin);
        if (options.customize) {
            options.customize(bitmap);
        }
        png.png(bitmap, stream);
        result = Buffer.concat(stream.filter(Boolean));
    }

    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Example:
```javascript
var qr = require(&#x27;qr-image&#x27;);

var qr_svg = qr.image(&#x27;I love QR!&#x27;, { type: &#x27;svg&#x27; });
qr_svg.pipe(require(&#x27;fs&#x27;).createWriteStream(&#x27;i_love_qr.svg&#x27;));

var svg_string = qr.<span class="apidocCodeKeywordSpan">imageSync</span>(&#x27;I love QR!&#x27;, { type: &#x27;svg&#x27; });
```

[More examples](./examples)

`qr = require(&#x27;qr-image&#x27;)`

### Methods
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix" id="apidoc.element.qr-image.matrix">
        function <span class="apidocSignatureSpan">qr-image.</span>matrix
        <span class="apidocSignatureSpan">(text, ec_level, parse_url)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function QR(text, ec_level, parse_url) {
    ec_level = EC_LEVELS.indexOf(ec_level) &#x3e; -1 ? ec_level : &#x27;M&#x27;;
    var message = encode(text, parse_url);
    var data = fillTemplate(message, getTemplate(message, ec_level));
    return matrix.getMatrix(data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
`qr = require(&#x27;qr-image&#x27;)`

### Methods

* `qr.image(text, [ec_level | options])` — Readable stream with image data;
* `qr.imageSync(text, [ec_level | options])` — string with image data. (Buffer for `png`);
* `qr.svgObject(text, [ec_level | options])` — object with SVG path and size;
* `qr.<span class="apidocCodeKeywordSpan">matrix</span>(text, [ec_level])` — 2D array.


### Options

* `text` — text to encode;
* `ec_level` — error correction level. One of `L`, `M`, `Q`, `H`. Default `M`.
* `options` — image options object:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.svgObject" id="apidoc.element.qr-image.svgObject">
        function <span class="apidocSignatureSpan">qr-image.</span>svgObject
        <span class="apidocSignatureSpan">(text, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function svg_object(text, options) {
    options = get_options(options, &#x27;svg&#x27;);

    var matrix = QR(text, options.ec_level);
    return vector.svg_object(matrix, options.margin);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

`qr = require(&#x27;qr-image&#x27;)`

### Methods

* `qr.image(text, [ec_level | options])` — Readable stream with image data;
* `qr.imageSync(text, [ec_level | options])` — string with image data. (Buffer for `png`);
* `qr.<span class="apidocCodeKeywordSpan">svgObject</span>(text, [ec_level | options])` — object with SVG path and size;
* `qr.matrix(text, [ec_level])` — 2D array.


### Options

* `text` — text to encode;
* `ec_level` — error correction level. One of `L`, `M`, `Q`, `H`. Default `M`.
...</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.qr-image.matrix" id="apidoc.module.qr-image.matrix">module qr-image.matrix</a></h1>


    <h2>
        <a href="#apidoc.element.qr-image.matrix.calculatePenalty" id="apidoc.element.qr-image.matrix.calculatePenalty">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>calculatePenalty
        <span class="apidocSignatureSpan">(matrix)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function calculatePenalty(matrix) {
    var N = matrix.length;
    var penalty = 0;
    // Rule 1
    for (var i = 0; i &#x3c; N; i++) {
        var pixel = matrix[i][0] &#x26; 1;
        var len = 1;
        for (var j = 1; j &#x3c; N; j++) {
            var p = matrix[i][j] &#x26; 1;
            if (p == pixel) {
                len++;
                continue;
            }
            if (len &#x3e;= 5) {
                penalty += len - 2;
            }
            pixel = p;
            len = 1;
        }
        if (len &#x3e;= 5) {
            penalty += len - 2;
        }
    }
    for (var j = 0; j &#x3c; N; j++) {
        var pixel = matrix[0][j] &#x26; 1;
        var len = 1;
        for (var i = 1; i &#x3c; N; i++) {
            var p = matrix[i][j] &#x26; 1;
            if (p == pixel) {
                len++;
                continue;
            }
            if (len &#x3e;= 5) {
                penalty += len - 2;
            }
            pixel = p;
            len = 1;
        }
        if (len &#x3e;= 5) {
            penalty += len - 2;
        }
    }

    // Rule 2
    for (var i = 0; i &#x3c; N - 1; i++) {
        for (var j = 0; j &#x3c; N - 1; j++) {
            var s = matrix[i][j] + matrix[i][j + 1] + matrix[i + 1][j] + matrix[i + 1][j + 1] &#x26; 7;
            if (s == 0 || s == 4) {
                penalty += 3;
            }
        }
    }

    // Rule 3
    function I(k) { return matrix[i][j + k] &#x26; 1 };
    function J(k) { return matrix[i + k][j] &#x26; 1 };
    for (var i = 0; i &#x3c; N; i++) {
        for (var j = 0; j &#x3c; N; j++) {
            if (j &#x3c; N - 6 &#x26;&#x26; I(0) &#x26;&#x26; !I(1) &#x26;&#x26; I(2) &#x26;&#x26; I(3) &#x26;&#x26; I(4) &#x26;&#x26; !I(5) &#x26;&#x26; I(6)) {
                if (j &#x3e;= 4 &#x26;&#x26; !(I(-4) || I(-3) || I(-2) || I(-1))) {
                    penalty += 40;
                }
                if (j &#x3c; N - 10 &#x26;&#x26; !(I(7) || I(8) || I(9) || I(10))) {
                    penalty += 40;
                }
            }

            if (i &#x3c; N - 6 &#x26;&#x26; J(0) &#x26;&#x26; !J(1) &#x26;&#x26; J(2) &#x26;&#x26; J(3) &#x26;&#x26; J(4) &#x26;&#x26; !J(5) &#x26;&#x26; J(6)) {
                if (i &#x3e;= 4 &#x26;&#x26; !(J(-4) || J(-3) || J(-2) || J(-1))) {
                    penalty += 40;
                }
                if (i &#x3c; N - 10 &#x26;&#x26; !(J(7) || J(8) || J(9) || J(10))) {
                    penalty += 40;
                }
            }
        }
    }

    // Rule 4
    var numDark = 0;
    for (var i = 0; i &#x3c; N; i++) {
        for (var j = 0; j &#x3c; N; j++) {
            if (matrix[i][j] &#x26; 1) numDark++;
        }
    }
    penalty += 10 * Math.floor(Math.abs(10 - 20 * numDark/(N * N)));

    return penalty;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.fillAlignAndTiming" id="apidoc.element.qr-image.matrix.fillAlignAndTiming">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillAlignAndTiming
        <span class="apidocSignatureSpan">(matrix)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fillAlignAndTiming(matrix) {
    var N = matrix.length;
    if (N &#x3e; 21) {
        var len = N - 13;
        var delta = Math.round(len / Math.ceil(len / 28));
        if (delta % 2) delta++;
        var res = [];
        for (var p = len + 6; p &#x3e; 10; p -= delta) {
            res.unshift(p);
        }
        res.unshift(6);
        for (var i = 0; i &#x3c; res.length; i++) {
            for (var j = 0; j &#x3c; res.length; j++) {
                var x = res[i], y = res[j];
                if (matrix[x][y]) continue;
                for (var r = -2; r &#x3c;=2 ; r++) {
                    for (var c = -2; c &#x3c;=2 ; c++) {
                        var max = Math.max(r, c);
                        var min = Math.min(r, c);
                        var pixel = (max == 1 &#x26;&#x26; min &#x3e;= -1) || (min == -1 &#x26;&#x26; max &#x3c;= 1) ? 0x80 : 0x81;
                        matrix[x + r][y + c] = pixel;
                    }
                }
            }
        }
    }
    for (var i = 8; i &#x3c; N - 8; i++) {
        matrix[6][i] = matrix[i][6] = i % 2 ? 0x80 : 0x81;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.fillData" id="apidoc.element.qr-image.matrix.fillData">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillData
        <span class="apidocSignatureSpan">(matrix, data, mask)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fillData(matrix, data, mask) {
    var N = matrix.length;
    var row, col, dir = -1;
    row = col = N - 1;
    var mask_fn = MASK_FUNCTIONS[mask];
    var len = data.blocks[data.blocks.length - 1].length;

    for (var i = 0; i &#x3c; len; i++) {
        for (var b = 0; b &#x3c; data.blocks.length; b++) {
            if (data.blocks[b].length &#x3c;= i) continue;
            put(data.blocks[b][i]);
        }
    }

    len = data.ec_len;
    for (var i = 0; i &#x3c; len; i++) {
        for (var b = 0; b &#x3c; data.ec.length; b++) {
            put(data.ec[b][i]);
        }
    }

    if (col &#x3e; -1) {
        do {
            matrix[row][col] = mask_fn(row, col) ? 1 : 0;
        } while (next());
    }

    function put(byte) {
        for (var mask = 0x80; mask; mask = mask &#x3e;&#x3e; 1) {
            var pixel = !!(mask &#x26; byte);
            if (mask_fn(row, col)) pixel = !pixel;
            matrix[row][col] = pixel ? 1 : 0;
            next();
        }
    }

    function next() {
        do {
            if ((col % 2) ^ (col &#x3c; 6)) {
                if (dir &#x3c; 0 &#x26;&#x26; row == 0 || dir &#x3e; 0 &#x26;&#x26; row == N - 1) {
                    col--;
                    dir = -dir;
                } else {
                    col++;
                    row += dir;
                }
            } else {
                col--;
            }
            if (col == 6) {
                col--;
            }
            if (col &#x3c; 0) {
                return false;
            }
        } while (matrix[row][col] &#x26; 0xf0);
        return true;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.fillFinders" id="apidoc.element.qr-image.matrix.fillFinders">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillFinders
        <span class="apidocSignatureSpan">(matrix)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fillFinders(matrix) {
    var N = matrix.length;
    for (var i = -3; i &#x3c;= 3; i++) {
        for (var j = -3; j &#x3c;= 3; j++) {
            var max = Math.max(i, j);
            var min = Math.min(i, j);
            var pixel = (max == 2 &#x26;&#x26; min &#x3e;= -2) || (min == -2 &#x26;&#x26; max &#x3c;= 2) ? 0x80 : 0x81;
            matrix[3 + i][3 + j] = pixel;
            matrix[3 + i][N - 4 + j] = pixel;
            matrix[N - 4 + i][3 + j] = pixel;
        }
    }
    for (var i = 0; i &#x3c; 8; i++) {
        matrix[7][i] = matrix[i][7] =
        matrix[7][N - i - 1] = matrix[i][N - 8] =
        matrix[N - 8][i] = matrix[N - 1 - i][7] = 0x80;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.fillReserved" id="apidoc.element.qr-image.matrix.fillReserved">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillReserved
        <span class="apidocSignatureSpan">(matrix, ec_level, mask)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fillReserved(matrix, ec_level, mask) {
    var N = matrix.length;
    var format = FORMATS[EC_LEVELS[ec_level] &#x3c;&#x3c; 3 | mask];
    function F(k) { return format &#x3e;&#x3e; k &#x26; 1 ? 0x81 : 0x80 };
    for (var i = 0; i &#x3c; 8; i++) {
        matrix[8][N - 1 - i] = F(i);
        if (i &#x3c; 6) matrix[i][8] = F(i);
    }
    for (var i = 8; i &#x3c; 15; i++) {
        matrix[N - 15 + i][8] = F(i);
        if (i &#x3e; 8) matrix[8][14 - i] = F(i);
    }
    matrix[7][8] = F(6);
    matrix[8][8] = F(7);
    matrix[8][7] = F(8);

    var version = VERSIONS[(N - 17)/4];
    if (!version) return;
    function V(k) { return version &#x3e;&#x3e; k &#x26; 1 ? 0x81 : 0x80 };
    for (var i = 0; i &#x3c; 6; i++) {
        for (var j = 0; j &#x3c; 3; j++) {
            matrix[N - 11 + j][i] = matrix[i][N - 11 + j] = V(i * 3 + j);
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.fillStub" id="apidoc.element.qr-image.matrix.fillStub">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>fillStub
        <span class="apidocSignatureSpan">(matrix)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fillStub(matrix) {
    var N = matrix.length;
    for (var i = 0; i &#x3c; 8; i++) {
        if (i != 6) {
            matrix[8][i] = matrix[i][8] = 0x80;
        }
        matrix[8][N - 1 - i] = 0x80;
        matrix[N - 1 - i][8] = 0x80;
    }
    matrix[8][8] = 0x80;
    matrix[N - 8][8] = 0x81;

    if (N &#x3c; 45) return;

    for (var i = N - 11; i &#x3c; N - 8; i++) {
        for (var j = 0; j &#x3c; 6; j++) {
            matrix[i][j] = matrix[j][i] = 0x80;
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.getMatrix" id="apidoc.element.qr-image.matrix.getMatrix">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>getMatrix
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMatrix(data) {
    var matrix = init(data.version);
    fillFinders(matrix);
    fillAlignAndTiming(matrix);
    fillStub(matrix);

    var penalty = Infinity;
    var bestMask = 0;
    for (var mask = 0; mask &#x3c; 8; mask++) {
        fillData(matrix, data, mask);
        fillReserved(matrix, data.ec_level, mask);
        var p = calculatePenalty(matrix);
        if (p &#x3c; penalty) {
            penalty = p;
            bestMask = mask;
        }
    }

    fillData(matrix, data, bestMask);
    fillReserved(matrix, data.ec_level, bestMask);

    return matrix.map(function(row) {
        return row.map(function(cell) {
            return cell &#x26; 1;
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

// {{{1 All-in-one
function QR(text, ec_level, parse_url) {
ec_level = EC_LEVELS.indexOf(ec_level) &#x3e; -1 ? ec_level : &#x27;M&#x27;;
var message = encode(text, parse_url);
var data = fillTemplate(message, getTemplate(message, ec_level));
return matrix.<span class="apidocCodeKeywordSpan">getMatrix</span>(data);
}

// {{{1 export functions
module.exports = {
QR: QR,
getTemplate: getTemplate,
fillTemplate: fillTemplate,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.matrix.init" id="apidoc.element.qr-image.matrix.init">
        function <span class="apidocSignatureSpan">qr-image.matrix.</span>init
        <span class="apidocSignatureSpan">(version)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(version) {
    var N = version * 4 + 17;
    var matrix = [];
    var zeros = new Buffer(N);
    zeros.fill(0);
    zeros = [].slice.call(zeros);
    for (var i = 0; i &#x3c; N; i++) {
        matrix[i] = zeros.slice();
    }
    return matrix;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.qr-image.png" id="apidoc.module.qr-image.png">module qr-image.png</a></h1>


    <h2>
        <a href="#apidoc.element.qr-image.png.png" id="apidoc.element.qr-image.png.png">
        function <span class="apidocSignatureSpan">qr-image.</span>png
        <span class="apidocSignatureSpan">(bitmap, stream)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function png(bitmap, stream) {
    stream.push(PNG_HEAD);

    var IHDR = Buffer.concat([PNG_IHDR]);
    IHDR.writeUInt32BE(bitmap.size, 8);
    IHDR.writeUInt32BE(bitmap.size, 12);
    IHDR.writeUInt32BE(crc32(IHDR.slice(4, -4)), 21);
    stream.push(IHDR);

    var IDAT = Buffer.concat([
        PNG_IDAT,
        zlib.deflateSync(bitmap.data, { level: 9 }),
        new Buffer(4)
    ]);
    IDAT.writeUInt32BE(IDAT.length - 12, 0);
    IDAT.writeUInt32BE(crc32(IDAT.slice(4, -4)), IDAT.length - 4);
    stream.push(IDAT);

    stream.push(PNG_IEND);
    stream.push(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.png.bitmap" id="apidoc.element.qr-image.png.bitmap">
        function <span class="apidocSignatureSpan">qr-image.png.</span>bitmap
        <span class="apidocSignatureSpan">(matrix, size, margin)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function bitmap(matrix, size, margin) {
    var N = matrix.length;
    var X = (N + 2 * margin) * size;
    var data = new Buffer((X + 1) * X);
    data.fill(255);
    for (var i = 0; i &#x3c; X; i++) {
        data[i * (X + 1)] = 0;
    }

    for (var i = 0; i &#x3c; N; i++) {
        for (var j = 0; j &#x3c; N; j++) {
            if (matrix[i][j]) {
                var offset = ((margin + i) * (X + 1) + (margin + j)) * size + 1;
                data.fill(0, offset, offset + size);
                for (var c = 1; c &#x3c; size; c++) {
                    data.copy(data, offset + c * (X + 1), offset, offset + size);
                }
            }
        }
    }

    return {
        data: data,
        size: X
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.qr-image.qr_base" id="apidoc.module.qr-image.qr_base">module qr-image.qr_base</a></h1>


    <h2>
        <a href="#apidoc.element.qr-image.qr_base.QR" id="apidoc.element.qr-image.qr_base.QR">
        function <span class="apidocSignatureSpan">qr-image.qr_base.</span>QR
        <span class="apidocSignatureSpan">(text, ec_level, parse_url)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function QR(text, ec_level, parse_url) {
    ec_level = EC_LEVELS.indexOf(ec_level) &#x3e; -1 ? ec_level : &#x27;M&#x27;;
    var message = encode(text, parse_url);
    var data = fillTemplate(message, getTemplate(message, ec_level));
    return matrix.getMatrix(data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.qr_base.fillTemplate" id="apidoc.element.qr-image.qr_base.fillTemplate">
        function <span class="apidocSignatureSpan">qr-image.qr_base.</span>fillTemplate
        <span class="apidocSignatureSpan">(message, template)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fillTemplate(message, template) {
    var blocks = new Buffer(template.data_len);
    blocks.fill(0);

    if (template.version &#x3c; 10) {
        message = message.data1;
    } else if (template.version &#x3c; 27) {
        message = message.data10;
    } else {
        message = message.data27;
    }

    var len = message.length;

    for (var i = 0; i &#x3c; len; i += 8) {
        var b = 0;
        for (var j = 0; j &#x3c; 8; j++) {
            b = (b &#x3c;&#x3c; 1) | (message[i + j] ? 1 : 0);
        }
        blocks[i / 8] = b;
    }

    var pad = 236;
    for (var i = Math.ceil((len + 4) / 8); i &#x3c; blocks.length; i++) {
        blocks[i] = pad;
        pad = (pad == 236) ? 17 : 236;
    }

    var offset = 0;
    template.blocks = template.blocks.map(function(n) {
        var b = blocks.slice(offset, offset + n);
        offset += n;
        template.ec.push(calculateEC(b, template.ec_len));
        return b;
    });

    return template;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.qr_base.getTemplate" id="apidoc.element.qr-image.qr_base.getTemplate">
        function <span class="apidocSignatureSpan">qr-image.qr_base.</span>getTemplate
        <span class="apidocSignatureSpan">(message, ec_level)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getTemplate(message, ec_level) {
    var i = 1;
    var len;

    if (message.data1) {
        len = Math.ceil(message.data1.length / 8);
    } else {
        i = 10;
    }
    for (/* i */; i &#x3c; 10; i++) {
        var version = versions[i][ec_level];
        if (version.data_len &#x3e;= len) {
            return _deepCopy(version);
        }
    }

    if (message.data10) {
        len = Math.ceil(message.data10.length / 8);
    } else {
        i = 27;
    }
    for (/* i */; i &#x3c; 27; i++) {
        var version = versions[i][ec_level];
        if (version.data_len &#x3e;= len) {
            return _deepCopy(version);
        }
    }

    len = Math.ceil(message.data27.length / 8);
    for (/* i */; i &#x3c; 41; i++) {
        var version = versions[i][ec_level];
        if (version.data_len &#x3e;= len) {
            return _deepCopy(version);
        }
    }
    throw new Error(&#x22;Too much data&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.qr-image.vector" id="apidoc.module.qr-image.vector">module qr-image.vector</a></h1>


    <h2>
        <a href="#apidoc.element.qr-image.vector.eps" id="apidoc.element.qr-image.vector.eps">
        function <span class="apidocSignatureSpan">qr-image.vector.</span>eps
        <span class="apidocSignatureSpan">(matrix, stream, margin)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EPS(matrix, stream, margin) {
    var N = matrix.length;
    var scale = 9;
    var X = (N + 2 * margin) * scale;
    stream.push([
        &#x27;%!PS-Adobe-3.0 EPSF-3.0&#x27;,
        &#x27;%%BoundingBox: 0 0 &#x27; + X + &#x27; &#x27; + X,
        &#x27;/h { 0 rlineto } bind def&#x27;,
        &#x27;/v { 0 exch neg rlineto } bind def&#x27;,
        &#x27;/M { neg &#x27; + (N + margin) + &#x27; add moveto } bind def&#x27;,
        &#x27;/z { closepath } bind def&#x27;,
        scale + &#x27; &#x27; + scale + &#x27; scale&#x27;,
        &#x27;&#x27;
    ].join(&#x27;\n&#x27;));

    matrix2path(matrix).forEach(function(subpath) {
        var res = &#x27;&#x27;;
        for (var k = 0; k &#x3c; subpath.length; k++) {
            var item = subpath[k];
            switch (item[0]) {
            case &#x27;M&#x27;:
                res += (item[1] + margin) + &#x27; &#x27; + item[2] + &#x27; M &#x27;;
                break;
            default:
                res += item[1] + &#x27; &#x27; + item[0] + &#x27; &#x27;;
            }
        }
        res += &#x27;z\n&#x27;;
        stream.push(res);
    });

    stream.push(&#x27;fill\n%%EOF\n&#x27;);
    stream.push(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.vector.pdf" id="apidoc.element.qr-image.vector.pdf">
        function <span class="apidocSignatureSpan">qr-image.vector.</span>pdf
        <span class="apidocSignatureSpan">(matrix, stream, margin)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PDF(matrix, stream, margin) {
    // TODO deflate
    var N = matrix.length;
    var scale = 9;
    var X = (N + 2 * margin) * scale;
    var data = [
        &#x27;%PDF-1.0\n\n&#x27;,
        &#x27;1 0 obj &#x3c;&#x3c; /Type /Catalog /Pages 2 0 R &#x3e;&#x3e; endobj\n&#x27;,
        &#x27;2 0 obj &#x3c;&#x3c; /Type /Pages /Count 1 /Kids [ 3 0 R ] &#x3e;&#x3e; endobj\n&#x27;,
    ];
    data.push(&#x27;3 0 obj &#x3c;&#x3c; /Type /Page /Parent 2 0 R /Resources &#x3c;&#x3c;&#x3e;&#x3e; &#x27; +
        &#x27;/Contents 4 0 R /MediaBox [ 0 0 &#x27; + X + &#x27; &#x27; + X + &#x27; ] &#x3e;&#x3e; endobj\n&#x27;);

    var path = scale + &#x27; 0 0 &#x27; + scale + &#x27; 0 0 cm\n&#x27;;
    path += matrix2path(matrix).map(function(subpath) {
        var res = &#x27;&#x27;;
        var x, y;
        for (var k = 0; k &#x3c; subpath.length; k++) {
            var item = subpath[k];
            switch (item[0]) {
            case &#x27;M&#x27;:
                x = item[1] + margin;
                y = N - item[2] + margin;
                res += x + &#x27; &#x27; + y + &#x27; m &#x27;;
                break;
            case &#x27;h&#x27;:
                x += item[1];
                res += x + &#x27; &#x27; + y + &#x27; l &#x27;;
                break;
            case &#x27;v&#x27;:
                y -= item[1];
                res += x + &#x27; &#x27; + y + &#x27; l &#x27;;
                break;
            }
        }
        res += &#x27;h&#x27;;
        return res;
    }).join(&#x27;\n&#x27;);
    path += &#x27;\nf\n&#x27;;
    data.push(&#x27;4 0 obj &#x3c;&#x3c; /Length &#x27; + path.length + &#x27; &#x3e;&#x3e; stream\n&#x27; +
        path + &#x27;endstream\nendobj\n&#x27;);

    var xref = &#x27;xref\n0 5\n0000000000 65535 f \n&#x27;;
    for (var i = 1, l = data[0].length; i &#x3c; 5; i++) {
        xref += (&#x27;0000000000&#x27; + l).substr(-10) + &#x27; 00000 n \n&#x27;;
        l += data[i].length;
    }
    data.push(
        xref,
        &#x27;trailer &#x3c;&#x3c; /Root 1 0 R /Size 5 &#x3e;&#x3e;\n&#x27;,
        &#x27;startxref\n&#x27; + l + &#x27;\n%%EOF\n&#x27;
    );
    stream.push(data.join(&#x27;&#x27;));
    stream.push(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.vector.svg" id="apidoc.element.qr-image.vector.svg">
        function <span class="apidocSignatureSpan">qr-image.vector.</span>svg
        <span class="apidocSignatureSpan">(matrix, stream, margin, size)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SVG(matrix, stream, margin, size) {
    var X = matrix.length + 2 * margin;
    stream.push(&#x27;&#x3c;svg xmlns=&#x22;http://www.w3.org/2000/svg&#x22; &#x27;);
    if (size &#x3e; 0) {
        var XY = X * size;
        stream.push(&#x27;width=&#x22;&#x27; + XY + &#x27;&#x22; height=&#x22;&#x27; + XY + &#x27;&#x22; &#x27;);
    }
    stream.push(&#x27;viewBox=&#x22;0 0 &#x27; + X + &#x27; &#x27; + X + &#x27;&#x22;&#x3e;&#x27;);
    stream.push(&#x27;&#x3c;path d=&#x22;&#x27;);
    pushSVGPath(matrix, stream, margin);
    stream.push(&#x27;&#x22;/&#x3e;&#x3c;/svg&#x3e;&#x27;);
    stream.push(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.qr-image.vector.svg_object" id="apidoc.element.qr-image.vector.svg_object">
        function <span class="apidocSignatureSpan">qr-image.vector.</span>svg_object
        <span class="apidocSignatureSpan">(matrix, margin)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SVG_object(matrix, margin) {
    var stream = [];
    pushSVGPath(matrix, stream, margin);

    var result = {
        size: matrix.length + 2 * margin,
        path: stream.filter(Boolean).join(&#x27;&#x27;)
    }

    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
